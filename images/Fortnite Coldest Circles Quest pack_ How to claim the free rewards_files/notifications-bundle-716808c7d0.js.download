var KeedaNotification=function(){function u(e){return"block"===e.style.display}return{init:function(n){document.addEventListener("click",function(e){-1<["keeda-notifications-container","kn-bell-icon","kn-bell-count"].indexOf(e.target.getAttribute("id"))||(n.querySelector("#kn-content-container").style.display="none",n.querySelector("#kn-pointer").style.display="none")})},displayNotifications:function(c,r){new Promise(function(n,t){pureJSAjaxGetWithCredentialsFlag(FRAMEWORK_URL+"/notifications",function(e){"string"==typeof e&&(e=JSON.parse(e)),n(e)},function(e){t(e)},!0)}).then(function(e){var n;0<e.length?(n=(e=e.map(function(e){var n=e.url;try{n=e.url}catch(e){}return{id:e.ID,text:e.text,link:n,status:e.status,date:e.created_date,image:e.notifier_pic}})).filter(function(e){return"not_seen"===e.status}).length,c.querySelector("#kn-bell-count").innerText=0===n?"":n,e.forEach(function(e,n){var i,t=c.querySelector("#kn-card"),o=(t.content.querySelector(".kn-card-wrapper").setAttribute("data-notification-id",e.id),t.content.querySelector(".kn-card-pic")),o=(e.image=e.image.replace("keeda.","keedag."),o.src=e.image,o.src=e.image,t.content.querySelector(".kn-card-a"));o.href=e.link,i=o,o=e.text,i.innerHTML="",o.forEach(function(e,n){var t;101===e.type?(t=document.createElement("b")).innerText=e.val:(t=document.createElement("span")).innerText=e.val,i.appendChild(t)});t.content.querySelector(".kn-card-date").innerHTML=timeSince(e.date.replace(/\s/,"T"));o=document.importNode(t.content,!0);c.querySelector("#kn-content-container .kn-card-container").appendChild(o),c.querySelectorAll(".kn-card-wrapper")[n].addEventListener("click",r.bind(this,e.link))})):c.querySelector("#kn-content-container .kn-card-container").innerHTML="No notifications"}).catch(function(e){console.log(e)})},addClickHandler:function(l,d){l.addEventListener("click",function(e){for(var n=l.querySelector("#kn-content-container"),t=l.querySelector("#kn-pointer"),i=(n.style.display="block"===n.style.display?"none":"block",t.style.display="block"===t.style.display?"none":"block",n.querySelector(".kn-card-container")),o=i.childNodes.length,c=[],r=0;r<o;r++){var a=i.childNodes[r];"function"==typeof a.getAttribute&&"kn-card-wrapper"===a.getAttribute("class")&&c.push(a.getAttribute("data-notification-id"))}u(n)&&"function"==typeof d&&d(e.target),window.innerWidth<768&&(u(n)?(t=$("body"))&&(t.style.overflow="hidden"):(e=$("body"))&&(e.style.overflow="scroll")),(c=c.join(","))&&u(n)&&pureJSAjaxPost(FRAMEWORK_URL+"/notifications/mark-as-seen",{ids:c},function(e){console.log(e),l.querySelector("#kn-bell-count").innerText=""},function(e){console.log(e)},null,!0)})}}}();function initNotifications(){var n;window.innerWidth<340||(n=$("#keeda-notifications-container"))&&n.parentNode&&(userSlug?(KeedaNotification.init(n),KeedaNotification.addClickHandler(n,function(e){"kn-bell-icon"===e.getAttribute("id")&&(e=""===(e=n.querySelector("#kn-bell-count").innerText)?0:e,ga_event_click("NOTIFICATION_BELL",e))}),KeedaNotification.displayNotifications(n,function(e,n){ga_event_click("NOTIFICATION_CLICK",e),window.location.href=e}),n.style.display="block"):n.parentNode.removeChild(n))}window.addEventListener("DOMContentLoaded",initNotifications),domContentLoaded&&initNotifications();